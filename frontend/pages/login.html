<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar Sesión - MillorNet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cyber: {
              primary: '#00ffff',
              secondary: '#ff00ff',
              dark: '#0a0a0f',
              card: '#11111f',
              accent: '#00ffaa',
              danger: '#ff0055'
            }
          }
        }
      }
    }
  </script>
  <style>
    .cyber-grid {
      background-image: 
        linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
      background-size: 30px 30px;
    }
  </style>
</head>
<body class="bg-cyber-dark text-white cyber-grid min-h-screen flex items-center justify-center p-4">
  
  <div class="relative w-full max-w-md">
    <!-- Efecto de borde cibernético -->
    <div class="absolute -inset-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-cyan-500 rounded-2xl blur opacity-30"></div>
    
    <div class="relative border-2 border-transparent bg-gradient-to-br from-gray-900 to-cyber-dark rounded-2xl p-8">
      <!-- Logo -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 mb-4">
          <i class="fas fa-shield-alt text-2xl"></i>
        </div>
        <h1 class="text-3xl font-bold text-cyan-400">INICIAR SESIÓN</h1>
        <p class="text-gray-400 mt-2">Accede a tu cuenta segura</p>
      </div>
      
      <!-- Formulario de inicio de sesión -->
      <form id="loginForm" class="space-y-6">
        <!-- Campo Email -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">
            <i class="fas fa-envelope mr-2"></i>Correo electrónico
          </label>
          <div class="relative">
            <input 
              type="email" 
              id="email" 
              placeholder="usuario@millornet.com"
              class="w-full px-4 py-3 pl-12 bg-gray-800 border border-gray-700 rounded-lg focus:border-cyan-500 focus:outline-none transition"
              required
            >
            <div class="absolute left-4 top-3.5 text-gray-500">
              <i class="fas fa-envelope"></i>
            </div>
          </div>
        </div>
        
        <!-- Campo Contraseña -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">
            <i class="fas fa-lock mr-2"></i>Contraseña
          </label>
          <div class="relative">
            <input 
              type="password" 
              id="password" 
              placeholder="••••••••"
              class="w-full px-4 py-3 pl-12 bg-gray-800 border border-gray-700 rounded-lg focus:border-cyan-500 focus:outline-none transition"
              required
            >
            <div class="absolute left-4 top-3.5 text-gray-500">
              <i class="fas fa-key"></i>
            </div>
            <button type="button" id="togglePassword" class="absolute right-4 top-3.5 text-gray-500 hover:text-cyan-400">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        
        <!-- Mensaje de error/éxito -->
        <div id="message" class="hidden p-4 rounded-lg text-center"></div>
        
        <!-- Botón de inicio de sesión -->
        <button 
          type="submit" 
          id="loginBtn"
          class="w-full py-3 px-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 rounded-lg font-bold text-lg transition duration-300 flex items-center justify-center"
        >
          <i class="fas fa-sign-in-alt mr-2"></i>
          <span id="btnText">INICIAR SESIÓN</span>
          <div id="btnLoading" class="hidden ml-2">
            <div class="animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"></div>
          </div>
        </button>
        
        <!-- Enlace a registro -->
        <div class="text-center pt-4 border-t border-gray-800">
          <p class="text-gray-400">
            ¿No tienes una cuenta? 
            <a href="/register" class="text-cyan-400 hover:text-cyan-300 font-medium transition">Regístrate</a>
          </p>
        </div>
      </form>
      
      <!-- Información de seguridad -->
      <div class="mt-8 p-4 bg-gray-900 rounded-lg">
        <div class="flex items-center text-sm text-gray-400">
          <i class="fas fa-shield-alt text-cyan-500 mr-3 text-lg"></i>
          <div>
            <p class="font-medium">Conexión segura</p>
            <p class="text-xs mt-1">Todos los datos están cifrados</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuración de la API
    const API = 'http://176.84.214.29:3000/api/auth';
    
    // Elementos del DOM
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('togglePassword');
    const loginBtn = document.getElementById('loginBtn');
    const btnText = document.getElementById('btnText');
    const btnLoading = document.getElementById('btnLoading');
    const messageDiv = document.getElementById('message');
    
    // Variables de estado
    let passwordVisible = false;
    
    // Inicializar la aplicación
    // Inicializar la aplicación
      document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
  // NO redirigir automáticamente desde el login
  // El usuario debe iniciar sesión manualmente
    });
    // Configurar event listeners
    function setupEventListeners() {
      // Mostrar/ocultar contraseña
      togglePasswordBtn.addEventListener('click', function() {
        passwordVisible = !passwordVisible;
        passwordInput.type = passwordVisible ? 'text' : 'password';
        this.innerHTML = passwordVisible ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
      });
      
      // Enviar formulario
      loginForm.addEventListener('submit', handleLogin);
    }
    
    // Manejar inicio de sesión - VERSIÓN SIMPLIFICADA Y FUNCIONAL
    async function handleLogin(e) {
      e.preventDefault();
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;
      
      // Validación básica
      if (!email || !password) {
        showMessage('Por favor, completa todos los campos', 'error');
        return;
      }
      
      // Mostrar estado de carga
      btnText.textContent = 'INICIANDO SESIÓN...';
      btnLoading.classList.remove('hidden');
      loginBtn.disabled = true;
      
      try {
        const response = await fetch(`${API}/login`, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            email: email, 
            password: password 
          })
        });
        
        // Manejar la respuesta
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.token) {
          // Login exitoso
          localStorage.setItem('token', data.token);
          localStorage.setItem('userEmail', email);
          
          // Extraer username del email
          const username = email.split('@')[0];
          localStorage.setItem('username', username);
          
          showMessage('¡Login correcto! Redirigiendo...', 'success');
          
          // ¡¡REDIRECCIÓN CORREGIDA!! - Usar ruta absoluta
          setTimeout(() => {
            window.location.href = '/dashboard.html';
          }, 1000);
          
        } else if (data.error) {
          // Error del servidor
          showMessage(data.error, 'error');
          resetLoginButton();
        } else {
          // Respuesta inesperada
          showMessage('Error inesperado en la respuesta', 'error');
          resetLoginButton();
        }
        
      } catch (error) {
        console.error('Error en el login:', error);
        
        let errorMessage = 'Error de conexión con el servidor';
        
        if (error.message.includes('Failed to fetch')) {
          errorMessage = 'No se puede conectar al servidor. Verifica tu conexión a internet.';
        } else if (error.message.includes('NetworkError')) {
          errorMessage = 'Error de red. Por favor, verifica tu conexión.';
        } else if (error.message.includes('HTTP error')) {
          errorMessage = `Error del servidor: ${error.message}`;
        }
        
        showMessage(errorMessage, 'error');
        resetLoginButton();
      }
    }
    
    // Restaurar estado del botón de login
    function resetLoginButton() {
      btnText.textContent = 'INICIAR SESIÓN';
      btnLoading.classList.add('hidden');
      loginBtn.disabled = false;
    }
    
    // Mostrar mensajes
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `p-4 rounded-lg text-center`;
      
      if (type === 'success') {
        messageDiv.classList.add('bg-green-900', 'border', 'border-green-700', 'text-green-300');
        messageDiv.innerHTML = `
          <div class="flex items-center justify-center">
            <i class="fas fa-check-circle mr-2"></i>
            ${text}
          </div>
        `;
      } else if (type === 'error') {
        messageDiv.classList.add('bg-red-900', 'border', 'border-red-700', 'text-red-300');
        messageDiv.innerHTML = `
          <div class="flex items-center justify-center">
            <i class="fas fa-exclamation-circle mr-2"></i>
            ${text}
          </div>
        `;
      }
      
      messageDiv.classList.remove('hidden');
      
      // Auto-ocultar mensajes de error después de 5 segundos
      if (type === 'error') {
        setTimeout(() => {
          messageDiv.classList.add('hidden');
        }, 5000);
      }
    }
  </script>
</body>
</html>